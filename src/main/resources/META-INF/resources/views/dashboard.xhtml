<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
                template="/templates/layout-dashboard.xhtml">

    <ui:define name="content">
        
        <div class="card-form">
            <h3 class="section-title"><i class="fa-solid fa-circle-plus"></i> Crear Nueva Oferta</h3>
            
            <h:form id="formOferta">
                <div class="form-grid">
                    <div class="input-group full-width">
                        <label>Título de la Oferta *</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.titulo}" 
                                    styleClass="form-control" 
                                    a:placeholder="Ej: Desarrollador Java Senior" 
                                    required="true" label="Título"/>
                    </div>

                    <div class="input-group">
                        <label>Empresa</label>
                        <h:inputText styleClass="form-control" value="Mi Empresa" readonly="true"/>
                    </div>
                    <div class="input-group">
                        <label>Salario Promedio ($)</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.salarioPromedio}" 
                                    styleClass="form-control" 
                                    a:type="number" a:step="0.01" a:placeholder="0.00"/>
                    </div>

                    <div class="input-group">
                        <label>Categoría *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idCategoria}" styleClass="form-control" required="true" label="Categoría">
                            <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                            <f:selectItems value="#{ofertaBean.listaCategorias}" var="cat" 
                                        itemLabel="#{cat.nombreCategoria}" itemValue="#{cat.idCategoria}"/>
                        </h:selectOneMenu>
                    </div>
                    <div class="input-group">
                        <label>Modalidad *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idModalidad}" styleClass="form-control" required="true" label="Modalidad">
                            <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                            <f:selectItems value="#{ofertaBean.listaModalidades}" var="mod" 
                                        itemLabel="#{mod.nombreModalidad}" itemValue="#{mod.idModalidad}"/>
                        </h:selectOneMenu>
                    </div>

                    <div class="input-group">
                        <label>Jornada *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idJornada}" styleClass="form-control" required="true" label="Jornada">
                            <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                            <f:selectItems value="#{ofertaBean.listaJornadas}" var="jor" 
                                        itemLabel="#{jor.nombreJornada}" itemValue="#{jor.idJornada}"/>
                        </h:selectOneMenu>
                    </div>
                    <div class="input-group">
                        <label>Ciudad *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idCiudad}" styleClass="form-control" required="true" label="Ciudad">
                            <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                            <f:selectItems value="#{ofertaBean.listaCiudades}" var="ciu" 
                                        itemLabel="#{ciu.nombreCiudad}" itemValue="#{ciu.idCiudad}"/>
                        </h:selectOneMenu>
                    </div>

                    <div class="input-group">
                        <label>Fecha Inicio *</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.fechaInicio}" styleClass="form-control" a:type="date" required="true" label="Fecha Inicio">
                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                        </h:inputText>
                    </div>
                    <div class="input-group">
                        <label>Fecha Cierre *</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.fechaCierre}" styleClass="form-control" a:type="date" required="true" label="Fecha Cierre">
                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                        </h:inputText>
                    </div>

                    <div class="input-group full-width">
                        <label>Descripción de la Oferta *</label>
                        <h:inputTextarea value="#{ofertaBean.ofertaActual.descripcion}" 
                                        styleClass="form-control" rows="4" 
                                        a:placeholder="Detalla los requisitos y beneficios..." required="true" label="Descripción"/>
                    </div>
                </div>

                <h:commandButton value="Publicar Oferta Laboral" action="#{ofertaBean.guardarOferta}" styleClass="btn-primary">
                    <f:ajax execute="@form" render="@form :listaOfertasForm"/> 
                </h:commandButton>
            </h:form>
        </div>

        <h3 class="section-title"><i class="fa-solid fa-briefcase"></i> Ofertas Publicadas</h3>

        <h:form id="listaOfertasForm">
            <ui:repeat value="#{ofertaBean.listaOfertas}" var="oferta">
                
                <div class="offer-card">
                    <div class="card-header">
                        <span>#{oferta.titulo}</span>
                        <span style="font-size: 0.8em; opacity: 0.8">ACTIVA</span>
                    </div>
                    <div class="card-body">
                        <p style="margin:0; font-size: 0.9em;">#{oferta.descripcion}</p>
                    </div>
                    <div class="card-footer">
                        <div>
                            <i class="fa-regular fa-calendar"></i> Inicio: 
                            <h:outputText value="#{oferta.fechaInicio}">
                                <f:convertDateTime pattern="yyyy-MM-dd"/>
                            </h:outputText>
                        </div>
                        
                        <div class="actions">
                            <h:commandButton value="Actualizar" action="#{ofertaBean.cargarParaEditar(oferta)}" styleClass="btn-edit">
                                <f:ajax render=":formOferta" />
                            </h:commandButton>

                            <h:commandButton value="Eliminar" action="#{ofertaBean.eliminarOferta(oferta)}" styleClass="btn-delete">
                                <f:ajax render=":listaOfertasForm" /> 
                            </h:commandButton>
                        </div>
                    </div>
                </div>

            </ui:repeat>
            
            <h:panelGroup rendered="#{empty ofertaBean.listaOfertas}">
                <p style="text-align:center; color:#888;">No hay ofertas registradas.</p>
            </h:panelGroup>
        </h:form>

    </ui:define>

</ui:composition>