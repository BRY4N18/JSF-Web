<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
                template="/templates/layout-dashboard.xhtml">

    <ui:define name="title">Gestión de Ofertas - Bolsa UTEQ</ui:define>

    <ui:define name="content">

        <div class="card-form">
            <h3 class="section-title">
                <i class="fa-solid fa-circle-plus"></i>
                <h:outputText value="#{ofertaBean.ofertaActual.idOferta != null ? ' Editar Oferta' : ' Crear Nueva Oferta'}" />
            </h3>

            <h:form id="formOferta">
                <h:messages id="msgsForm" globalOnly="false" style="color:red; list-style:none; padding:0;" />

                <div class="form-grid">
                    <div class="input-group full-width">
                        <label>Título de la Oferta *</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.titulo}"
                                     styleClass="form-control"
                                     a:placeholder="Ej: Desarrollador Java Senior"
                                     required="true" label="Título"/>
                    </div>

                    <div class="input-group">
                        <label>Empresa</label>
                        <h:inputText styleClass="form-control" value="#{sessionScope.nombre_usuario}" readonly="true"/>
                    </div>
                    <div class="input-group">
                        <label>Salario Promedio ($)</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.salarioPromedio}"
                                     styleClass="form-control"
                                     a:type="number" a:step="0.01" a:placeholder="0.00"/>
                    </div>

                    <div class="input-group">
                        <label>Categoría *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idCategoria}" styleClass="form-control" required="true">
                            <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{ofertaBean.listaCategorias}" var="cat"
                                           itemLabel="#{cat.nombreCategoria}" itemValue="#{cat.idCategoria}"/>
                        </h:selectOneMenu>
                    </div>

                    <div class="input-group">
                        <label>Modalidad *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idModalidad}" styleClass="form-control" required="true">
                            <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{ofertaBean.listaModalidades}" var="m"
                                           itemLabel="#{m.nombreModalidad}" itemValue="#{m.idModalidad}"/>
                        </h:selectOneMenu>
                    </div>

                    <div class="input-group">
                        <label>Jornada *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idJornada}" styleClass="form-control" required="true">
                            <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{ofertaBean.listaJornadas}" var="j"
                                           itemLabel="#{j.nombreJornada}" itemValue="#{j.idJornada}"/>
                        </h:selectOneMenu>
                    </div>

                    <div class="input-group">
                        <label>Ciudad *</label>
                        <h:selectOneMenu value="#{ofertaBean.ofertaActual.idCiudad}" styleClass="form-control" required="true">
                            <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{ofertaBean.listaCiudades}" var="c"
                                           itemLabel="#{c.nombreCiudad}" itemValue="#{c.idCiudad}"/>
                        </h:selectOneMenu>
                    </div>

                    <div class="input-group">
                        <label>Fecha Inicio *</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.fechaInicio}" styleClass="form-control" a:type="date" required="true">
                            <f:convertDateTime pattern="yyyy-MM-dd" type="date" />
                        </h:inputText>
                    </div>
                    <div class="input-group">
                        <label>Fecha Cierre *</label>
                        <h:inputText value="#{ofertaBean.ofertaActual.fechaCierre}" styleClass="form-control" a:type="date" required="true">
                            <f:convertDateTime pattern="yyyy-MM-dd" type="date" />
                        </h:inputText>
                    </div>

                    <div class="input-group full-width">
                        <label>Descripción de la Oferta *</label>
                        <h:inputTextarea value="#{ofertaBean.ofertaActual.descripcion}"
                                         styleClass="form-control" rows="4"
                                         a:placeholder="Detalla los requisitos y beneficios..." required="true"/>
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <h:commandButton value="#{ofertaBean.ofertaActual.idOferta != null ? 'Actualizar Oferta' : 'Publicar Oferta Laboral'}"
                                     action="#{ofertaBean.guardarOferta}"
                                     styleClass="btn-primary">
                        <f:ajax execute="@form" render="@form :listaOfertasForm :globalMessages" />
                    </h:commandButton>

                    <h:commandButton value="Cancelar / Limpiar" action="#{ofertaBean.limpiarFormulario}"
                                     immediate="true"
                                     styleClass="btn-secondary">
                        <f:ajax render="@form" />
                    </h:commandButton>
                </div>
            </h:form>
        </div>

        <h3 class="section-title"><i class="fa-solid fa-briefcase"></i> Ofertas Publicadas</h3>

        <h:form id="listaOfertasForm">
            <h:panelGroup id="panelLista">
                <ui:repeat value="#{ofertaBean.listaOfertas}" var="o">
                    <div class="offer-card">
                        <div class="card-header">
                            <strong>#{o.titulo}</strong>
                            <span class="badge">#{o.estadoOferta}</span>
                        </div>
                        <div class="card-body">
                            <p>#{o.descripcion}</p>
                        </div>
                        <div class="card-footer">
                            <div class="date-info">
                                <i class="fa-regular fa-calendar"></i>
                                <h:outputText value=" Inicio: " />
                                <h:outputText value="#{o.fechaInicio}" />
                            </div>

                            <div class="actions">
                                <h:commandLink action="#{ofertaBean.cargarParaEditar(o)}" styleClass="btn-edit">
                                    <i class="fa-solid fa-pen-to-square"></i> Editar
                                    <f:ajax render=":formOferta" />
                                </h:commandLink>

                                <h:commandLink action="#{ofertaBean.eliminarOferta(o)}"
                                               styleClass="btn-delete"
                                               onclick="return confirm('¿Seguro que deseas eliminar esta oferta?');">
                                    <i class="fa-solid fa-trash"></i> Eliminar
                                    <f:ajax render=":listaOfertasForm" />
                                </h:commandLink>
                            </div>
                        </div>
                    </div>
                </ui:repeat>

                <h:panelGroup rendered="#{empty ofertaBean.listaOfertas}">
                    <div class="empty-state">
                        <p>No hay ofertas registradas en este momento.</p>
                    </div>
                </h:panelGroup>
            </h:panelGroup>
        </h:form>

    </ui:define>

</ui:composition>

